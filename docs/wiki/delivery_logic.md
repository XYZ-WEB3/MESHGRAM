# Алгоритм доставки сообщений

1. **Приём Telegram**
   - TelegramClient принимает сообщение, выдаёт ID и создаёт `QueuedMessage` (outbound).
   - Пользователь получает подтверждение о постановке в очередь при отсутствии LoRa связи.
2. **Отправка в LoRa**
   - MeshtasticClient периодически запрашивает `QueueManager.get_next_outbound`.
   - Между пакетами выдерживается `throttle_seconds`, чтобы не перегружать сеть.
3. **Повторы**
   - Если не получено подтверждение, сообщение остаётся в голове очереди до истечения `retry_delay` и пробует снова. Счётчик `retries` доступен в логах.
4. **Приём LoRa**
   - Входящий пакет разбирается: если это команда (`/`), ответ генерирует `CommandHandler`. Если `#ID текст`, сообщение направляется Telegram-пользователю.
5. **Очередь inbound** (MVP) собирает ответы до момента, когда Telegram становится онлайн, затем сообщения доставляются пакетно.
6. **FloodWait защита**
   - При превышении лимитов TelegramClient выдерживает `floodwait_padding` секунд, прежде чем повторно отправлять.
