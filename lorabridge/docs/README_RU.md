# LoraBridge Messenger

## О проекте
LoraBridge Messenger — Python-сервис, который соединяет удалённые Meshtastic-узлы с Telegram без участия сотовой связи. Пользователь в тайге пишет сообщения через LoRa mesh, а собеседник в Telegram получает и отправляет ответы, как будто ничего не изменилось.

## Как установить
1. Клонируйте репозиторий и перейдите в папку `lorabridge`.
2. Создайте виртуальное окружение `python -m venv .venv` и активируйте его.
3. Установите зависимости: `pip install -r requirements.txt`.
4. (Опционально) установите pre-commit: `pre-commit install`.

## Как запустить
```bash
python -m src.main run
```
Для проверки состояния используйте `python -m src.main status`, для очистки очередей — `python -m src.main flush`.

## Конфигурация
- Основные настройки: `config/settings.json`.
- Секреты: `config/.env` (создайте из `.env.example`).
- Пользовательские данные и история: `data/users.json` и `data/logs/`.

## Подключение Telegram-аккаунта
1. Создайте бота у [BotFather](https://t.me/BotFather).
2. Вставьте токен в `config/.env` в переменную `TELEGRAM_TOKEN`.
3. Перезапустите сервис — бот автоматически авторизуется.

## Подключение Meshtastic
1. Подключите устройство к USB и убедитесь, что оно доступно, например `/dev/ttyUSB0`.
2. Настройте порт и скорость в `config/settings.json`.
3. При запуске моста Meshtastic-модуль откроет Serial API и начнёт обмен данными.

## Поддерживаемые команды
| Команда | Описание |
| --- | --- |
| `/ulist` | список активных пользователей | 
| `/history #ID` | последние сообщения выбранного ID | 
| `/msg #ID текст` | ручное сообщение адресату | 
| `/status` | состояние связи | 
| `/net` | статус Telegram + ошибки | 
| `/mesh` | параметры Meshtastic | 
| `/flush` | очистка очереди | 
| `/help` | подсказка по командам |

## Логика ID
- Каждому уникальному Telegram-пользователю автоматически назначается ID `#1`, `#2` и т.д.
- Соответствия живут 48 часов, после чего могут быть выданы заново.
- Хранение ведётся в `data/users.json`, история ограничена 50 последними событиями.

## Что уже работает
- Одновременная очередь сообщений для направлений Telegram ↔ Meshtastic.
- CLI для запуска, статуса и ручной очистки очередей.
- Модуль выдачи ID и хранения истории.
- Командный процессор с базовыми обработчиками.
- Логирование в вращающиеся файлы.

## Что запланировано
Смотрите `docs/wiki/future_plans.md` для подробностей: там описаны расширения медиа, управление LoRa-устройством, GUI и другие функции.

## Таблица возможностей
| Возможность | Статус |
| --- | --- |
| Текст Telegram → LoRa | ✔ Реализовано |
| Текст LoRa → Telegram | ✔ Реализовано |
| Очередь сообщений | ✔ Реализовано |
| Команда /ulist | ✔ Реализовано |
| Автовыдача ID | ✔ Реализовано |
| Распознавание фото | ✖ В разработке |
| Транскрипция голосовых | ✖ В разработке |
| Видео → описание | ✖ В разработке |
| Управление LoRa через команды | ✖ В разработке |
| GUI EXE приложение | ✖ Будет позже |
