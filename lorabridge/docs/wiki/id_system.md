# Система ID

## Цели
- Анонимизировать Telegram-пользователей в LoRa-сети.
- Ограничить время жизни соответствия, чтобы можно было перераспределить номера.
- Хранить историю переписки для команд `/history` и диагностики.

## Алгоритм
1. При первом сообщении Telegram-модуль запрашивает ID у `UserMappingManager`.
2. Менеджер увеличивает `last_id` и присваивает пользователю значение `#N`.
3. Информация записывается в `data/users.json` с временем выдачи `assigned_at`.
4. При каждом сообщении история пополняется объектами `{timestamp, direction, text}`.
5. При листинге `/ulist` возвращаются только записи, срок жизни которых меньше 48 часов.

## Сброс ID
- Плановый cron очищает записи старше 48 часов.
- Администратор может вручную удалить JSON или вызвать `/flush` (в будущем — отдельная команда `/resetid`).

## Хранилище
- По умолчанию JSON-файл.
- В будущем возможно переключение на SQLite для гибкого поиска и индексации.
